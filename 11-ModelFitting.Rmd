# Mathematical Models and Experimental Data

```{block, type='objectives'}
**Checklist**

Before we begin, be sure you've prepared the following:

1. Open MATLAB.
2. Navigate to your Biol120 working folder and create a new folder for today's lab.
3. Open a new live script and use the header text to place the title for today's lab.
```


\
\
Today's laboratory will be focused on creating a mathematical model to use on real experimental data.


## Importing Numerical Data

* Using dlmread

  + The data must be in a delimited format (i.e. a matrix of values, with entries separated by spaces, tabs, or commas).
  + The data file must be in your `Current Folder` (the same place your live script is saved).
  + When using `dlmread()`, the filename needs to be in single quotation marks.
  + Save your data to a new variable when you read it into MATLAB (i.e. `D = dlmread('mydata.txt')`).
  
    Example:
    
    First we make sure the data file is in our `Current Folder`, use `dlmread()` to read it and save it to a new variable, D.  
    Note: We can then check that our data is indeed contained in the matrix D.
    
    ![](import_GT.png)
    
    If we want to visualize our dataset before moving on to model fitting, we can use the `plot()` command.
    
    Note: In this example, the first column of data contains the independent variable (\% AP) and the second column of data contains the dependent variable (normalized GT mRNA concentration).
    ![](GT_figure.png)
  
  
  
  ```{block, type='rmdquestion'}
#### Question 1
  Download the *dicty* average growth data generated in the Larochelle Lab from the course Canvas site.
  
  Save this file in your `Current Folder`.
  
  Use the `dlmread()` command to read in the data and save it as a matrix (you can call this matrix whatever you want - i.e. I used D in the example above).
  
  Use a scatter plot to visualize the data.  
  * The first column is time (in hours), the second column is the corresponding population of AX4 cells (in thous. cells / mL), and the third column is the corresponding population of DnmA Knock Out cells (in thous. cells / mL).   
      Hint: To visualize both populations on the same figure, scatter one, then   
      `hold on` and scatter the other.      
  * Include a title and don't forget to label your axes.    
  * You can also add a legend using the drop down menu: `Insert -> Legend`.
```


## Creating a Model Function

Looking at your data, you now want to create a mathematical model to fit to your data.  We have seen two different models for population growth in class.  You may choose to fit one of these functions to the *dicty* average growth data or you may choose to create a new function based on something you have learned in another class or textbook.  Whatever model you choose, it will be important that you answer each of the following:

  1. Do you have a good reason for choosing your model?  It could be as simple as "my data seems to follow the shape of the curve generated by this model". 
  
  2. What are the underlying model assumptions?  i.e. The population has the ability to grow without bound.
  
  3. What are the independent variable(s), parameter(s), and dependent variable(s)?  This is where it is important to think about both the model (which will dictate parameter(s)) and the data (which will dictate how you choose independent vs dependent variables).
  
  4. Does the model do what I want it to do?  Before moving on to the next section of this chapter or thinking about fitting your model to data, make sure the function you wrote does what you want it to do!  You can check that it runs, gives the output in the format you expect, and even create some figures to see how the curve changes as you plug in different parameter values.

  ```{block, type='rmdquestion'}
#### Question 2
  Create a model in MATLAB that you will use for the *dicty* growth data.  
  
  Note: You will want to create a single MATLAB function to use on both data sets.  The model parameters are what should change the shape of your curve. We will later use this function to fit the correct parameter values in order to obtain one set of parameter values for the AX4 cells and another set for the DnmA KO cells.
  
  After creating your model function, answer each of the 4 questions above.
```

## Creating an Objective / Error Function

For Model Fitting, we also need an Objective Function (which we will minimize).  The most popular Objective Function is the Error Function calculated by taking the Sum of Square Errors (SSE):
$$SSE = \sum_{i=1}^n \left(y_i - m_i\right)^2$$
Luckily, MATLAB has a function that sums square terms of a vector for us, `sumsqr()`.

Examples:

1)  

![](sumsqr1.png)
        Note: $1^2+2^2+3^2+4^2 = 30$  
      
2)  

![](sumsqr2.png)
        Note: $\left(1-1.4\right)^2+\left(2-1.7\right)^2+\left(3-2.9\right)^2+\left(4-4.2\right)^2 = 0.3$
        
To create an Objective Function, the function needs to take the model parameter(s) and experimental data as input.  The output should always be a *single number*, the SSE.

Example:

Lets assume we have some experimental data of the position of a frog as it jumps.  We upload the data in to MATLAB and use a scatter plot to visualize.
![](frog_jump.png)
Just looking at the data's shape, we suggest using a quadratic model to fit this data.  (This also fits what we have learned about projectile motion in Intro Physics.)

Next, we write the model function:
![](funpar.png)
Now we need to write our Objective Function to calculate the error between the model and experimental data.  The Objective Function should take as input: our parameter(s) as a *single vector* and our experimental data.  It should output a *single value*, the SSE.
![](quad_error.png)
Before moving on, we should run the Objective Function (with any parameter values we choose for now) just to make sure it runs and outputs a single number with no errors.
![](try_SSE.png)
        
```{block, type='rmdquestion'}
#### Question 3
  Create an objective function in the following way: 
  
  + The input should be the model parameter(s) as a single vector and the experimental data (as two vectors, values for the dependent variable and independent variable).
  + The function should run the model you created in Question 2 with the parameter(s) given and vector of dependent variable values.
  + The function should then calculate the SSE between the model output and the experimental data.
  + The output should be the SSE value.
```
  
   
        
## Preparing to Fit your Model

We have experimental data, a mathematical model, and an objective funciton: now what?

Now we need to find the parameter values that minimize that objective function.

There are many ways to do this.  In this section we will learn how to implement a local method of parameter estimation in MATLAB.  Local methods take an initial guess for the parameter values and search nearby using techniques from Calculus or Geometry.  In MATLAB, the most common function to use is `fminsearch()`.  This function uses the Nelder-Mead simplex algorithm, but you don't have to worry about that for this course.  Just focus on how to run it.  
 
\ 
\
For the remainder of this lab, we will make sure we are comfortable with the objective function we have created, and will work on finding a good initial guess for the parameter values.

          
```{block, type='rmdquestion'}
#### Question 4
  Using your objective function, try running it for BOTH the AX4 and WT data with a variety of different parameter values.   
  
  + Remember that the input should be the model parameter(s) as a single vector and the experimental data (as two vectors, values for the dependent variable and independent variable).
  You can choose any parameter value(s) you want, but remember that we are trying to find a set of parameters that will MINIMIZE our SSE value.
  + For each of the two data sets, state what the BEST parameter values you tried were and the resulting SSE.  We will use these as a starting point for our model fitting in Chapter 13.
```


```{block, type='objectives'}
**Submission**

Don't forget to submit your live script file (with all of the questions answered - via text or code) and any m files or functions that you wrote in MATLAB to help answer these questions.  If it is easier, you can also upload your figures separately.
```

